<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAZDAR!</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans&display=swap" rel="stylesheet">

<style>
/* UNCHANGED STYLES */
body {
  margin: 0;
  font-family: 'Open Sans', sans-serif;
  background: linear-gradient(160deg,#888,#ccc);
  color: #ffd700;
  overflow-x: hidden;
}
body::before, body::after {
  content: "✈";
  position: fixed;
  color: rgba(255,215,0,0.25);
  font-size: 250px;
  pointer-events: none;
  animation: floatPlane 30s infinite linear;
}
body::before { top: 10%; left: -200px; transform: rotate(-15deg); }
body::after { top: 60%; left: 70%; transform: rotate(15deg); animation-direction: reverse; }
@keyframes floatPlane {0%{transform:translateX(0) rotate(-15deg);opacity:0.25;}50%{opacity:0.1;}100%{transform:translateX(110vw) rotate(-15deg);opacity:0.25;}}

.container {
  max-width: 540px;
  margin: 20px auto;
  background: linear-gradient(145deg,#555,#777);
  border-radius: 18px;
  padding: 30px 40px 40px 40px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.6);
}
#mainTitle { text-align:center; font-family:'Montserrat',sans-serif; font-size:34px; text-shadow:0 0 6px #ffd700,0 0 18px #ffd700;}
#dateTime, #nameday { text-align:center; font-size:18px; margin-bottom:10px; color:#ffd700;}

.item {
  background:#777;
  margin-top:12px;
  padding:18px 20px;
  border-radius:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:18px;
  font-weight:700;
  color:#ffd700;
  cursor:pointer;
}
.selected { background:#ffd700; color:#000 !important; }
.remove-btn { background:#ff5555; color:white; width:34px; height:34px; border-radius:50%; text-align:center; font-size:18px; }

.action-btn {
  width:100%;
  padding:16px;
  margin-top:12px;
  font-size:18px;
  font-weight:800;
  background:#4CAF50;
  color:#fff;
  border-radius:14px;
  cursor:pointer;
}

.date-btn { width:120px; padding:10px; font-size:14px; border-radius:12px; background:#666; cursor:pointer; }
.date-btn.selected { background:#ffd700; color:#000; }

table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { border:1px solid #ffd700; padding:6px; font-size:14px; font-weight:700; }

textarea, input { width:100%; padding:10px; border-radius:10px; margin-top:5px; font-size:16px; }
</style>
</head>
<body>

<div class="container">

<h2 id="mainTitle">NAZDAR!</h2>
<div id="dateTime"></div>
<div id="nameday">Svátek: …</div>

<h2>Employees</h2>
<div id="employees"></div>
<input id="newEmployee" placeholder="Add employee name…">
<button class="action-btn" onclick="addEmployee()">Add Employee</button>

<h2>Aircraft</h2>
<div id="aircrafts"></div>
<input id="newAircraft" placeholder="Add aircraft registration…">
<button class="action-btn" onclick="addAircraft()">Add Aircraft</button>

<h2>Date of Log</h2>
<div id="dateSelection">
  <div class="date-btn" onclick="selectLogDate('dayBeforeYesterday')">Day Before Yesterday</div>
  <div class="date-btn" onclick="selectLogDate('yesterday')">Yesterday</div>
  <div class="date-btn selected" onclick="selectLogDate('today')">Today</div>
</div>

<h2>Hours Worked</h2>
<input type="number" id="hours" value="1" step="0.5">

<h2>Comment</h2>
<textarea id="comment"></textarea>
<button class="action-btn" onclick="saveLog()">Save</button>

<h2>Recent Logs (Summed Hours)</h2>
<div id="historyTableContainer"></div>

</div>

<script>
// ---------- FIREBASE ----------
firebase.initializeApp({
  apiKey: "AIzaSyDy9FB7VOZigjURYvtPVk3iBCj0kzFAk8E",
  authDomain: "labourlogger.firebaseapp.com",
  projectId: "labourlogger"
});
const db = firebase.firestore();

// ---------- DATA ----------
let employees = [];
let aircraftList = [];
let logs = [];
let selectedEmployee="", selectedAircraft=[], selectedLogDate="today";

// ---------- EMPLOYEES SYNC ----------
db.collection("employees").orderBy("name").onSnapshot(snap=>{
  employees=[];
  snap.forEach(d=>employees.push(d.data().name));
  renderEmployees();
});

// ---------- AIRCRAFT SYNC ----------
db.collection("aircraft").orderBy("name").onSnapshot(snap=>{
  aircraftList=[];
  snap.forEach(d=>aircraftList.push(d.data().name));
  renderAircrafts();
});

// ---------- LOGS SYNC ----------
db.collection("logs").onSnapshot(snap=>{
  logs=[];
  snap.forEach(d=>logs.push(d.data()));
  updateHistoryTable();
});

// ---------- RENDER ----------
function renderEmployees(){
  employeesDiv.innerHTML="";
  employees.forEach(e=>{
    const d=document.createElement("div");
    d.className="item"+(e===selectedEmployee?" selected":"");
    d.innerHTML=`<span>${e} ✈</span>`;
    d.onclick=()=>{selectedEmployee=e;renderEmployees();};
    employeesDiv.appendChild(d);
  });
}
function renderAircrafts(){
  aircraftsDiv.innerHTML="";
  aircraftList.forEach(a=>{
    const d=document.createElement("div");
    d.className="item"+(selectedAircraft.includes(a)?" selected":"");
    d.innerHTML=`<span>${a} ✈</span>`;
    d.onclick=()=>toggleAircraft(a);
    aircraftsDiv.appendChild(d);
  });
}
function toggleAircraft(a){
  selectedAircraft.includes(a)?selectedAircraft=selectedAircraft.filter(x=>x!==a):selectedAircraft.push(a);
  renderAircrafts();
}

// ---------- ADD ----------
function addEmployee(){
  const v=newEmployee.value.trim();
  if(v) db.collection("employees").add({name:v});
  newEmployee.value="";
}
function addAircraft(){
  const v=newAircraft.value.trim();
  if(v) db.collection("aircraft").add({name:v});
  newAircraft.value="";
}

// ---------- DATE ----------
function selectLogDate(d){ selectedLogDate=d; }

// ---------- SAVE ----------
function saveLog(){
  if(!selectedEmployee||!selectedAircraft.length) return alert("Select employee & aircraft");
  selectedAircraft.forEach(ac=>{
    db.collection("logs").add({
      employee:selectedEmployee,
      aircraft:ac,
      hours:+hours.value,
      comment:comment.value,
      date:new Date().toISOString()
    });
  });
  selectedAircraft=[];
  renderAircrafts();
}

// ---------- HISTORY ----------
function updateHistoryTable(){
  let sums={};
  logs.forEach(l=>{
    const k=l.aircraft+"|"+l.employee;
    sums[k]=(sums[k]||0)+l.hours;
  });
  let h='<table><tr><th>Aircraft</th><th>Employee</th><th>Hours</th></tr>';
  for(let k in sums){
    let p=k.split("|");
    h+=`<tr><td>${p[0]}</td><td>${p[1]}</td><td>${sums[k]}</td></tr>`;
  }
  historyTableContainer.innerHTML=h+"</table>";
}

// ---------- INIT ----------
const employeesDiv=employees;
const aircraftsDiv=aircrafts;
</script>
</body>
</html>
