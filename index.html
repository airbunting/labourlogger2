<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NAZDAR!</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Open Sans', sans-serif;
  background: linear-gradient(160deg,#888,#ccc);
  color: #ffd700;
}
.container {
  max-width: 540px;
  margin: 20px auto;
  background: linear-gradient(145deg,#555,#777);
  border-radius: 18px;
  padding: 30px 40px 40px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.6);
}
#mainTitle { text-align:center; font-family:'Montserrat',sans-serif; font-size:34px; }
#dateTime, #nameday { text-align:center; font-size:18px; margin-bottom:10px; }

.item {
  background:#777;
  margin-top:12px;
  padding:18px 20px;
  border-radius:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
}
.item:hover { background:#888; }
.selected { background:#ffd700; color:#000; }

.remove-btn {
  background:#ff5555;
  color:white;
  width:34px;
  height:34px;
  border-radius:50%;
  text-align:center;
  font-size:18px;
}

.action-btn {
  width:100%;
  padding:16px;
  margin-top:12px;
  font-size:18px;
  font-weight:800;
  background:#4CAF50;
  color:#fff;
  border-radius:14px;
  cursor:pointer;
}

.date-btn {
  width:120px;
  padding:10px;
  font-size:14px;
  text-align:center;
  border-radius:12px;
  background:#666;
  cursor:pointer;
}
.date-btn.selected { background:#ffd700; color:#000; }

table {
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th, td {
  border:1px solid #ffd700;
  padding:6px;
  font-size:14px;
  text-align:center;
  font-weight:700;
}
th { background:#555; }

input, textarea {
  width:100%;
  padding:10px;
  border-radius:10px;
  margin-top:5px;
  font-size:16px;
}
#confirmation {
  text-align:center;
  margin-top:10px;
  color:#00ff00;
  font-weight:bold;
  display:none;
}
</style>
</head>
<body>

<div class="container">
<h2 id="mainTitle">NAZDAR!</h2>
<div id="dateTime"></div>
<div id="nameday">Sv√°tek: ‚Ä¶</div>

<h2>Employees</h2>
<div id="employees"></div>
<input id="newEmployee" placeholder="Add employee name‚Ä¶">
<button class="action-btn" onclick="addEmployee()">Add Employee</button>

<h2>Aircraft</h2>
<div id="aircrafts"></div>
<input id="newAircraft" placeholder="Add aircraft registration‚Ä¶">
<button class="action-btn" onclick="addAircraft()">Add Aircraft</button>

<h2>Date of Log</h2>
<div style="display:flex;gap:10px;justify-content:center;">
  <div class="date-btn" onclick="selectLogDate('dayBeforeYesterday')">Day Before Yesterday</div>
  <div class="date-btn" onclick="selectLogDate('yesterday')">Yesterday</div>
  <div class="date-btn selected" onclick="selectLogDate('today')">Today</div>
</div>

<h2>Hours Worked</h2>
<input type="number" id="hours" value="1" step="0.5">

<h2>Comment</h2>
<textarea id="comment"></textarea>

<button class="action-btn" onclick="saveLog()">Save</button>
<div id="confirmation">Log saved!</div>

<h2>Recent Logs (Summed Hours)</h2>
<div id="historyTableContainer"></div>
</div>

<script>
// üî• FIREBASE CONFIG
firebase.initializeApp({
  apiKey: "AIzaSyDy9FB7VOZigjURYvtPVk3iBCj0kzFAk8E",
  authDomain: "labourlogger.firebaseapp.com",
  projectId: "labourlogger"
});
const db = firebase.firestore();

// LOCAL DATA
let employees = JSON.parse(localStorage.getItem("employees")||'["John","Mike","Anna"]');
let aircraftList = JSON.parse(localStorage.getItem("aircrafts")||'["OK-AIM","OK-ABC"]');
let logs = [];
let selectedEmployee="", selectedAircraft=[], selectedLogDate="today";

// TIME
setInterval(()=>{
  document.getElementById("dateTime").textContent =
    new Date().toLocaleString("cs-CZ");
},1000);

// RENDER
function renderEmployees(){
  employeesDiv.innerHTML="";
  employees.forEach(e=>{
    const d=document.createElement("div");
    d.className="item"+(e===selectedEmployee?" selected":"");
    d.textContent=e;
    d.onclick=()=>{selectedEmployee=e;renderEmployees();};
    employeesDiv.appendChild(d);
  });
}
function renderAircrafts(){
  aircraftsDiv.innerHTML="";
  aircraftList.forEach(a=>{
    const d=document.createElement("div");
    d.className="item"+(selectedAircraft.includes(a)?" selected":"");
    d.textContent=a;
    d.onclick=()=>toggleAircraft(a);
    aircraftsDiv.appendChild(d);
  });
}
function toggleAircraft(a){
  selectedAircraft.includes(a)
    ? selectedAircraft=selectedAircraft.filter(x=>x!==a)
    : selectedAircraft.push(a);
  renderAircrafts();
}

// ADD
function addEmployee(){
  const v=newEmployee.value.trim();
  if(v&&!employees.includes(v)){
    employees.push(v);
    localStorage.setItem("employees",JSON.stringify(employees));
    renderEmployees();
    newEmployee.value="";
  }
}
function addAircraft(){
  const v=newAircraft.value.trim();
  if(v&&!aircraftList.includes(v)){
    aircraftList.push(v);
    localStorage.setItem("aircrafts",JSON.stringify(aircraftList));
    renderAircrafts();
    newAircraft.value="";
  }
}

// DATE
function selectLogDate(d){ selectedLogDate=d; }

// SAVE
function saveLog(){
  if(!selectedEmployee||!selectedAircraft.length)return alert("Select employee & aircraft");

  let date=new Date();
  if(selectedLogDate==="yesterday")date.setDate(date.getDate()-1);
  if(selectedLogDate==="dayBeforeYesterday")date.setDate(date.getDate()-2);

  selectedAircraft.forEach(ac=>{
    db.collection("logs").add({
      employee:selectedEmployee,
      aircraft:ac,
      hours:+hours.value,
      comment:comment.value,
      date:date.toISOString(),
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
  });

  comment.value="";
  hours.value=1;
  selectedAircraft=[];
  renderAircrafts();

  confirmation.style.display="block";
  setTimeout(()=>confirmation.style.display="none",2000);
}

// üî• REAL-TIME SYNC
db.collection("logs")
  .orderBy("date","desc")
  .onSnapshot(snap=>{
    logs=[];
    snap.forEach(d=>logs.push(d.data()));
    updateHistoryTable();
  });

function updateHistoryTable(){
  let sums={};
  logs.forEach(l=>{
    const k=l.aircraft+"|"+l.employee;
    sums[k]=(sums[k]||0)+l.hours;
  });
  let h='<table><tr><th>Aircraft</th><th>Employee</th><th>Hours</th></tr>';
  for(let k in sums){
    let p=k.split("|");
    h+=`<tr><td>${p[0]}</td><td>${p[1]}</td><td>${sums[k]}</td></tr>`;
  }
  historyTableContainer.innerHTML=h+"</table>";
}

// INIT
const employeesDiv=employees;
const aircraftsDiv=aircrafts;
renderEmployees();
renderAircrafts();
</script>
</body>
</html>
